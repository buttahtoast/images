{
    "variables": {
    },

    "builders": [
        {
            "type": "qemu",
      	    "iso_url": "https://cloud.debian.org/images/cloud/{{ user `version_name` }}/{{ user `build_version` }}/debian-{{ user `version` }}-genericcloud-amd64-{{ user `build_version` }}.qcow2",
            "iso_checksum": "{{ user `iso_checksum` }}",
            "output_directory": "tmp",
            "shutdown_command": "sudo sh -c 'userdel -f packer && shutdown now'",
            "disk_size": "10000",
            "format": "qcow2",
            "ssh_username": "packer",
            "ssh_password": "packer",
            "accelerator": "kvm",
            "vm_name": "debian-{{ user `version` }} {{ user `build_version` }}.qcow2",
            "boot_wait": "1s",
            "headless": true,
            "disk_image": true,
            "qemuargs": [
                [ "-m", "2048M" ],
                ["-smp", "2"],
                ["-cdrom", "debian/cloud-init/seed.img"]
            ]
            
        }
    ],
    "provisioners": [
        {
            "type": "shell",
            "inline": [
                "sudo apt update && sudo apt -y install open-iscsi",
                "sudo apt install qemu-guest-agent -y && sudo systemctl enable qemu-guest-agent",
                "sudo dhclient -r && rm /etc/udev/rules.d/*",
                "echo 'reset cloud-init' && sudo cloud-init clean  &&  sudo rm /etc/machine-id"
            ]
        }
    ]
}
